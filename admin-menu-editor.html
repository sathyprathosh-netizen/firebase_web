<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Menu Editor ‚Äî CULINA-SUITE</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <style>
        .admin-layout {
            display: grid;
            grid-template-columns: 220px 1fr;
            min-height: calc(100vh - var(--nav-height) - 52px);
        }

        .admin-sidebar {
            background: var(--color-base-800);
            border-right: 1px solid var(--border-subtle);
            display: flex;
            flex-direction: column;
            padding: var(--space-4);
        }

        .admin-main {
            padding: var(--space-5) var(--space-6);
        }

        .admin-nav-item {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-3) var(--space-4);
            border-radius: var(--radius-md);
            color: var(--text-secondary);
            font-size: var(--text-sm);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
            margin-bottom: 2px;
            text-decoration: none;
        }

        .admin-nav-item:hover,
        .admin-nav-item.active {
            color: var(--color-primary);
            background: var(--color-primary-ghost);
        }

        .admin-nav-section {
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: .1em;
            color: var(--text-micro);
            padding: var(--space-4) var(--space-4) var(--space-2);
        }

        .editor-toolbar {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            margin-bottom: var(--space-5);
            flex-wrap: wrap;
        }

        .cat-filter {
            padding: 6px 16px;
            border-radius: var(--radius-full);
            font-size: var(--text-xs);
            font-weight: 700;
            cursor: pointer;
            border: 1px solid var(--border-subtle);
            background: var(--surface-glass);
            color: var(--text-secondary);
            transition: all 0.2s;
        }

        .cat-filter.active {
            background: var(--color-primary-ghost);
            border-color: var(--border-primary);
            color: var(--color-primary);
        }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: var(--space-4);
        }

        .menu-item-card {
            background: var(--surface-card);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-xl);
            padding: var(--space-5);
            transition: all 0.3s ease;
            position: relative;
        }

        .menu-item-card:hover {
            border-color: var(--border-primary);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }

        .item-status {
            position: absolute;
            top: var(--space-4);
            right: var(--space-4);
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .item-actions {
            display: flex;
            gap: var(--space-2);
            margin-top: var(--space-4);
        }

        .item-btn {
            flex: 1;
            padding: 8px;
            border-radius: var(--radius-md);
            font-size: 11px;
            font-weight: 700;
            cursor: pointer;
            border: 1px solid var(--border-subtle);
            background: var(--surface-glass);
            color: var(--text-secondary);
            text-align: center;
            transition: all 0.2s;
        }

        .item-btn:hover {
            background: var(--color-primary-ghost);
            border-color: var(--border-primary);
            color: var(--color-primary);
        }

        .item-btn.danger:hover {
            background: rgba(255, 80, 80, 0.1);
            border-color: rgba(255, 80, 80, 0.3);
            color: #ff5050;
        }

        .price-tag {
            font-size: var(--text-lg);
            font-weight: 900;
            color: var(--color-primary);
        }

        .search-input {
            padding: 8px 16px;
            border-radius: var(--radius-full);
            font-size: var(--text-xs);
            font-weight: 600;
            border: 1px solid var(--border-subtle);
            background: var(--surface-glass);
            color: var(--text-primary);
            outline: none;
            width: 240px;
            font-family: inherit;
            transition: border-color 0.2s;
        }

        .search-input:focus {
            border-color: var(--border-primary);
        }

        .search-input::placeholder {
            color: var(--text-muted);
        }

        @media(max-width:1200px) {
            .admin-sidebar {
                display: none;
            }

            .admin-layout {
                grid-template-columns: 1fr;
            }
        }

        @media(max-width:768px) {
            .menu-grid {
                grid-template-columns: 1fr;
            }
        }

        /* ‚îÄ‚îÄ MODAL OVERLAY ‚îÄ‚îÄ */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(8px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .modal-overlay.show {
            opacity: 1;
            pointer-events: all;
        }

        .modal-box {
            background: var(--color-base-800);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-xl);
            padding: var(--space-6);
            width: 480px;
            max-width: 92vw;
            max-height: 85vh;
            overflow-y: auto;
            transform: translateY(20px) scale(0.97);
            transition: transform 0.3s ease;
        }

        .modal-overlay.show .modal-box {
            transform: translateY(0) scale(1);
        }

        .modal-title {
            font-size: var(--text-lg);
            font-weight: 900;
            margin-bottom: var(--space-5);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .modal-form-group {
            margin-bottom: var(--space-4);
        }

        .modal-label {
            font-size: var(--text-xs);
            font-weight: 700;
            color: var(--text-secondary);
            margin-bottom: 6px;
            display: block;
        }

        .modal-input,
        .modal-select {
            width: 100%;
            padding: 10px 14px;
            border-radius: var(--radius-md);
            font-size: var(--text-sm);
            font-weight: 600;
            border: 1px solid var(--border-subtle);
            background: var(--surface-glass);
            color: var(--text-primary);
            outline: none;
            font-family: inherit;
            transition: border-color 0.2s;
            box-sizing: border-box;
        }

        .modal-input:focus,
        .modal-select:focus {
            border-color: var(--border-primary);
            box-shadow: 0 0 0 3px rgba(0, 212, 180, 0.1);
        }

        .modal-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-3);
        }

        .modal-actions {
            display: flex;
            gap: var(--space-3);
            margin-top: var(--space-5);
            justify-content: flex-end;
        }

        .modal-btn {
            padding: 10px 24px;
            border-radius: var(--radius-full);
            font-size: var(--text-xs);
            font-weight: 800;
            cursor: pointer;
            border: 1px solid var(--border-subtle);
            background: var(--surface-glass);
            color: var(--text-secondary);
            transition: all 0.2s;
            font-family: inherit;
        }

        .modal-btn:hover {
            background: rgba(255, 255, 255, 0.06);
        }

        .modal-btn.primary {
            background: var(--color-primary-ghost);
            border-color: var(--border-primary);
            color: var(--color-primary);
        }

        .modal-btn.primary:hover {
            background: var(--color-primary);
            color: var(--color-base-900);
        }

        .modal-btn.danger {
            background: rgba(255, 80, 80, 0.1);
            border-color: rgba(255, 80, 80, 0.3);
            color: #ff5050;
        }

        .modal-btn.danger:hover {
            background: #ff5050;
            color: #fff;
        }

        .toggle-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-3) 0;
        }

        .toggle-switch {
            width: 44px;
            height: 24px;
            background: var(--color-base-600);
            border-radius: 12px;
            position: relative;
            cursor: pointer;
            transition: background 0.3s;
            flex-shrink: 0;
        }

        .toggle-switch.on {
            background: var(--color-primary);
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 18px;
            height: 18px;
            background: white;
            border-radius: 50%;
            top: 3px;
            left: 3px;
            transition: transform 0.3s;
        }

        .toggle-switch.on::after {
            transform: translateX(20px);
        }

        /* ‚îÄ‚îÄ DELETE CONFIRM ‚îÄ‚îÄ */
        .delete-confirm-body {
            text-align: center;
            padding: var(--space-4) 0;
        }

        .delete-icon {
            font-size: 48px;
            margin-bottom: var(--space-3);
        }

        .delete-item-name {
            font-size: var(--text-base);
            font-weight: 800;
            color: #ff5050;
            margin-bottom: var(--space-2);
        }

        .delete-warning {
            font-size: var(--text-xs);
            color: var(--text-muted);
            max-width: 300px;
            margin: 0 auto;
        }

        /* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
        .toast {
            position: fixed;
            bottom: 24px;
            right: 24px;
            z-index: 2000;
            padding: 12px 24px;
            border-radius: var(--radius-lg);
            font-size: var(--text-xs);
            font-weight: 700;
            color: #fff;
            transform: translateY(80px);
            opacity: 0;
            transition: all 0.4s cubic-bezier(.4, 0, .2, 1);
            pointer-events: none;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast.success {
            background: linear-gradient(135deg, #00d4b4, #00a98e);
            box-shadow: 0 8px 24px rgba(0, 212, 180, 0.3);
        }

        .toast.error {
            background: linear-gradient(135deg, #ff5050, #cc3030);
            box-shadow: 0 8px 24px rgba(255, 80, 80, 0.3);
        }

        .toast.warning {
            background: linear-gradient(135deg, #ffb347, #ff8c00);
            box-shadow: 0 8px 24px rgba(255, 140, 0, 0.3);
        }
    </style>
</head>

<body>
    <nav class="cs-nav"></nav>
    <div class="cs-page" style="display:flex;flex-direction:column;min-height:100vh;">
        <div
            style="padding:var(--space-3) var(--space-5);background:var(--color-base-800);border-bottom:1px solid var(--border-subtle);display:flex;align-items:center;gap:var(--space-4);">
            <div style="font-size:var(--text-base);font-weight:800;">Menu Editor</div>
            <div style="font-size:var(--text-xs);color:var(--text-muted);">The Grand Brasserie ¬∑ Menu Management</div>
            <div style="margin-left:auto;display:flex;align-items:center;gap:var(--space-3);">
                <div style="font-size:var(--text-xs);color:var(--text-muted);" data-item-count>16 items</div>
                <span class="badge badge-success">PUBLISHED</span>
            </div>
        </div>

        <div class="admin-layout" style="flex:1;">
            <div class="admin-sidebar">
                <div style="margin-bottom:var(--space-4);">
                    <div style="font-size:var(--text-xs);color:var(--text-muted);">Logged in as</div>
                    <div style="font-size:var(--text-sm);font-weight:700;">Arun Sharma</div>
                    <div class="badge badge-info" style="margin-top:4px;">Owner</div>
                </div>
                <div class="admin-nav-section">Analytics</div>
                <a href="admin.html" class="admin-nav-item"><span>üìä</span> Overview</a>
                <a href="admin-revenue.html" class="admin-nav-item"><span>üí∞</span> Revenue</a>
                <a href="admin-menu-performance.html" class="admin-nav-item"><span>üçΩÔ∏è</span> Menu Performance</a>
                <div class="admin-nav-section">Management</div>
                <a href="admin-menu-editor.html" class="admin-nav-item active"><span>üìã</span> Menu Editor</a>
                <a href="admin-settings.html" class="admin-nav-item"><span>‚öôÔ∏è</span> Settings</a>
            </div>

            <div class="admin-main">
                <!-- TOOLBAR -->
                <div class="editor-toolbar">
                    <input type="text" class="search-input" placeholder="üîç Search menu items..." id="menuSearch">
                    <div style="display:flex;gap:var(--space-2);flex-wrap:wrap;" id="catFilters"></div>
                    <div style="margin-left:auto;">
                        <button class="item-btn"
                            style="padding:8px 20px;background:var(--color-primary-ghost);border-color:var(--border-primary);color:var(--color-primary);font-family:inherit;"
                            onclick="openAddModal()">+ Add Item</button>
                    </div>
                </div>

                <!-- ITEMS GRID -->
                <div class="menu-grid" id="menuGrid"></div>
            </div>
        </div>
    </div>

    <!-- EDIT MODAL -->
    <div class="modal-overlay" id="editModal">
        <div class="modal-box">
            <div class="modal-title">‚úèÔ∏è Edit Menu Item</div>
            <div class="modal-form-group">
                <label class="modal-label">Item Name</label>
                <input type="text" class="modal-input" id="editName">
            </div>
            <div class="modal-form-group">
                <label class="modal-label">Category</label>
                <select class="modal-select" id="editCat"></select>
            </div>
            <div class="modal-row">
                <div class="modal-form-group">
                    <label class="modal-label">Selling Price (‚Çπ)</label>
                    <input type="number" class="modal-input" id="editPrice">
                </div>
                <div class="modal-form-group">
                    <label class="modal-label">Cost Price (‚Çπ)</label>
                    <input type="number" class="modal-input" id="editCost">
                </div>
            </div>
            <div class="toggle-row">
                <div>
                    <div style="font-size:var(--text-xs);font-weight:700;">Vegetarian</div>
                    <div style="font-size:10px;color:var(--text-muted);">Mark as veg item</div>
                </div>
                <div class="toggle-switch" id="editVeg" onclick="this.classList.toggle('on')"></div>
            </div>
            <div class="toggle-row">
                <div>
                    <div style="font-size:var(--text-xs);font-weight:700;">Popular / Bestseller</div>
                    <div style="font-size:10px;color:var(--text-muted);">Highlight as popular item</div>
                </div>
                <div class="toggle-switch" id="editPopular" onclick="this.classList.toggle('on')"></div>
            </div>
            <div class="toggle-row">
                <div>
                    <div style="font-size:var(--text-xs);font-weight:700;">Active on Menu</div>
                    <div style="font-size:10px;color:var(--text-muted);">Visible to customers</div>
                </div>
                <div class="toggle-switch" id="editActive" onclick="this.classList.toggle('on')"></div>
            </div>
            <div id="editMarginPreview"
                style="margin-top:var(--space-3);padding:var(--space-3);background:var(--surface-glass);border-radius:var(--radius-md);font-size:var(--text-xs);text-align:center;">
            </div>
            <div class="modal-actions">
                <button class="modal-btn" onclick="closeModal('editModal')">Cancel</button>
                <button class="modal-btn primary" onclick="saveEdit()">üíæ Save Changes</button>
            </div>
        </div>
    </div>

    <!-- DELETE CONFIRM MODAL -->
    <div class="modal-overlay" id="deleteModal">
        <div class="modal-box" style="width:400px;">
            <div class="modal-title" style="color:#ff5050;">‚ö†Ô∏è Delete Item</div>
            <div class="delete-confirm-body">
                <div class="delete-icon">üóëÔ∏è</div>
                <div class="delete-item-name" id="deleteItemName"></div>
                <div class="delete-warning">This action will permanently remove this item from the menu. This cannot be
                    undone.</div>
            </div>
            <div class="modal-actions" style="justify-content:center;">
                <button class="modal-btn" onclick="closeModal('deleteModal')">Cancel</button>
                <button class="modal-btn danger" onclick="confirmDelete()">üóëÔ∏è Delete Permanently</button>
            </div>
        </div>
    </div>

    <!-- ADD ITEM MODAL -->
    <div class="modal-overlay" id="addModal">
        <div class="modal-box">
            <div class="modal-title">‚ûï Add New Item</div>
            <div class="modal-form-group">
                <label class="modal-label">Item Name</label>
                <input type="text" class="modal-input" id="addName" placeholder="e.g. Chicken Tikka Masala">
            </div>
            <div class="modal-form-group">
                <label class="modal-label">Category</label>
                <select class="modal-select" id="addCat"></select>
            </div>
            <div class="modal-row">
                <div class="modal-form-group">
                    <label class="modal-label">Selling Price (‚Çπ)</label>
                    <input type="number" class="modal-input" id="addPrice" placeholder="0">
                </div>
                <div class="modal-form-group">
                    <label class="modal-label">Cost Price (‚Çπ)</label>
                    <input type="number" class="modal-input" id="addCost" placeholder="0">
                </div>
            </div>
            <div class="toggle-row">
                <div>
                    <div style="font-size:var(--text-xs);font-weight:700;">Vegetarian</div>
                    <div style="font-size:10px;color:var(--text-muted);">Mark as veg item</div>
                </div>
                <div class="toggle-switch" id="addVeg" onclick="this.classList.toggle('on')"></div>
            </div>
            <div class="toggle-row">
                <div>
                    <div style="font-size:var(--text-xs);font-weight:700;">Popular / Bestseller</div>
                    <div style="font-size:10px;color:var(--text-muted);">Highlight as popular item</div>
                </div>
                <div class="toggle-switch" id="addPopular" onclick="this.classList.toggle('on')"></div>
            </div>
            <div class="modal-actions">
                <button class="modal-btn" onclick="closeModal('addModal')">Cancel</button>
                <button class="modal-btn primary" onclick="saveNewItem()">‚ûï Add to Menu</button>
            </div>
        </div>
    </div>

    <!-- TOAST -->
    <div class="toast" id="toast"></div>

    <script src="js/script.js"></script>
    <script>
        // ‚îÄ‚îÄ DATA STORE ‚îÄ‚îÄ
        const menuItems = [
            { name: 'Butter Chicken', cat: 'Mains', price: 800, cost: 256, active: true, popular: true, veg: false },
            { name: 'Dal Makhani', cat: 'Mains', price: 600, cost: 168, active: true, popular: true, veg: true },
            { name: 'Paneer Tikka', cat: 'Starters', price: 600, cost: 210, active: true, popular: true, veg: true },
            { name: 'Espresso Martini', cat: 'Cocktails', price: 700, cost: 126, active: true, popular: true, veg: true },
            { name: 'Truffle Mushroom Risotto', cat: 'Mains', price: 900, cost: 378, active: true, popular: false, veg: true },
            { name: 'Chicken Biryani', cat: 'Mains', price: 600, cost: 216, active: true, popular: true, veg: false },
            { name: 'Gulab Jamun', cat: 'Desserts', price: 300, cost: 66, active: true, popular: false, veg: true },
            { name: 'Masala Chai', cat: 'Beverages', price: 150, cost: 22, active: true, popular: false, veg: true },
            { name: 'Caesar Salad', cat: 'Starters', price: 450, cost: 202, active: true, popular: false, veg: false },
            { name: 'Tandoori Roti', cat: 'Breads', price: 60, cost: 12, active: true, popular: false, veg: true },
            { name: 'Garlic Naan', cat: 'Breads', price: 80, cost: 18, active: true, popular: false, veg: true },
            { name: 'Fruit Platter', cat: 'Desserts', price: 350, cost: 217, active: false, popular: false, veg: true },
            { name: 'Steamed Vegetables', cat: 'Sides', price: 250, cost: 120, active: false, popular: false, veg: true },
            { name: 'Old Fashioned', cat: 'Cocktails', price: 650, cost: 130, active: true, popular: false, veg: true },
            { name: 'Mango Lassi', cat: 'Beverages', price: 200, cost: 40, active: true, popular: false, veg: true },
            { name: 'Lamb Rogan Josh', cat: 'Mains', price: 950, cost: 380, active: true, popular: false, veg: false },
        ];

        let activeFilter = 'All';
        let editIndex = -1;
        let deleteIndex = -1;

        function getCategories() {
            return [...new Set(menuItems.map(i => i.cat))];
        }

        // ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ
        function showToast(msg, type = 'success') {
            const t = document.getElementById('toast');
            t.textContent = msg;
            t.className = 'toast ' + type;
            requestAnimationFrame(() => t.classList.add('show'));
            setTimeout(() => t.classList.remove('show'), 2500);
        }

        // ‚îÄ‚îÄ MODAL HELPERS ‚îÄ‚îÄ
        function openModal(id) {
            document.getElementById(id).classList.add('show');
        }

        function closeModal(id) {
            document.getElementById(id).classList.remove('show');
        }

        // Close modals on overlay click
        document.querySelectorAll('.modal-overlay').forEach(overlay => {
            overlay.addEventListener('click', e => {
                if (e.target === overlay) overlay.classList.remove('show');
            });
        });

        // Close modals on Escape key
        document.addEventListener('keydown', e => {
            if (e.key === 'Escape') {
                document.querySelectorAll('.modal-overlay.show').forEach(m => m.classList.remove('show'));
            }
        });

        // ‚îÄ‚îÄ ITEM COUNT ‚îÄ‚îÄ
        function updateItemCount() {
            const countEl = document.querySelector('[data-item-count]');
            if (countEl) countEl.textContent = menuItems.length + ' items';
        }

        // ‚îÄ‚îÄ FILTERS ‚îÄ‚îÄ
        function renderFilters() {
            const cats = getCategories();
            document.getElementById('catFilters').innerHTML = ['All', ...cats].map(c =>
                `<div class="cat-filter ${c === activeFilter ? 'active' : ''}" onclick="setFilter('${c}')">${c}</div>`
            ).join('');
        }

        function setFilter(cat) {
            activeFilter = cat;
            renderFilters();
            renderMenu();
        }

        // ‚îÄ‚îÄ RENDER MENU ‚îÄ‚îÄ
        function renderMenu() {
            const search = document.getElementById('menuSearch').value.toLowerCase();
            const filtered = menuItems.map((item, idx) => ({ ...item, _idx: idx })).filter(item => {
                const matchCat = activeFilter === 'All' || item.cat === activeFilter;
                const matchSearch = item.name.toLowerCase().includes(search);
                return matchCat && matchSearch;
            });

            document.getElementById('menuGrid').innerHTML = filtered.map(item => {
                const margin = Math.round(((item.price - item.cost) / item.price) * 100);
                const i = item._idx;
                return `
                <div class="menu-item-card" style="${!item.active ? 'opacity:0.6;' : ''}">
                    <div class="item-status" style="background:${item.active ? 'var(--color-success)' : 'var(--text-muted)'};box-shadow:0 0 8px ${item.active ? 'var(--color-success)' : 'transparent'};" title="${item.active ? 'Active' : 'Paused'}"></div>
                    <div style="display:flex;align-items:center;gap:var(--space-2);margin-bottom:var(--space-2);">
                        <span style="font-size:16px;">${item.veg ? 'üü¢' : 'üî¥'}</span>
                        <span class="cat-filter active" style="pointer-events:none;font-size:9px;padding:2px 8px;">${item.cat}</span>
                        ${item.popular ? '<span class="badge badge-warning" style="font-size:9px;">‚òÖ POPULAR</span>' : ''}
                        ${!item.active ? '<span class="badge badge-error" style="font-size:9px;">PAUSED</span>' : ''}
                    </div>
                    <div style="font-size:var(--text-sm);font-weight:800;margin-bottom:var(--space-2);">${item.name}</div>
                    <div style="display:flex;justify-content:space-between;align-items:flex-end;margin-bottom:var(--space-2);">
                        <div class="price-tag">‚Çπ${item.price}</div>
                        <div style="text-align:right;">
                            <div style="font-size:10px;color:var(--text-muted);">Cost ‚Çπ${item.cost} ¬∑ Margin</div>
                            <div style="font-size:var(--text-xs);font-weight:800;color:${margin >= 60 ? 'var(--color-success)' : margin >= 40 ? 'var(--color-warning)' : 'var(--color-error)'};">${margin}%</div>
                        </div>
                    </div>
                    <div class="item-actions">
                        <div class="item-btn" onclick="openEditModal(${i})">‚úèÔ∏è Edit</div>
                        <div class="item-btn" onclick="togglePause(${i})">${item.active ? '‚è∏Ô∏è Pause' : '‚ñ∂Ô∏è Enable'}</div>
                        <div class="item-btn danger" onclick="openDeleteModal(${i})">üóëÔ∏è</div>
                    </div>
                </div>`;
            }).join('');
        }

        // ‚îÄ‚îÄ EDIT ‚îÄ‚îÄ
        function openEditModal(idx) {
            editIndex = idx;
            const item = menuItems[idx];
            document.getElementById('editName').value = item.name;
            document.getElementById('editPrice').value = item.price;
            document.getElementById('editCost').value = item.cost;

            // Populate categories
            const catSelect = document.getElementById('editCat');
            catSelect.innerHTML = getCategories().map(c =>
                `<option value="${c}" ${c === item.cat ? 'selected' : ''}>${c}</option>`
            ).join('');

            // Set toggles
            document.getElementById('editVeg').className = 'toggle-switch' + (item.veg ? ' on' : '');
            document.getElementById('editPopular').className = 'toggle-switch' + (item.popular ? ' on' : '');
            document.getElementById('editActive').className = 'toggle-switch' + (item.active ? ' on' : '');

            updateMarginPreview();
            openModal('editModal');
        }

        function updateMarginPreview() {
            const price = parseInt(document.getElementById('editPrice').value) || 0;
            const cost = parseInt(document.getElementById('editCost').value) || 0;
            const margin = price > 0 ? Math.round(((price - cost) / price) * 100) : 0;
            const profit = price - cost;
            const color = margin >= 60 ? 'var(--color-success)' : margin >= 40 ? 'var(--color-warning)' : 'var(--color-error)';
            document.getElementById('editMarginPreview').innerHTML =
                `<span style="color:var(--text-muted);">Margin:</span> <span style="font-weight:900;color:${color};">${margin}%</span> ¬∑ <span style="color:var(--text-muted);">Profit:</span> <span style="font-weight:900;color:${color};">‚Çπ${profit}</span>`;
        }

        document.getElementById('editPrice')?.addEventListener('input', updateMarginPreview);
        document.getElementById('editCost')?.addEventListener('input', updateMarginPreview);

        function saveEdit() {
            if (editIndex < 0) return;
            const name = document.getElementById('editName').value.trim();
            if (!name) { showToast('Item name cannot be empty', 'error'); return; }

            const item = menuItems[editIndex];
            item.name = name;
            item.cat = document.getElementById('editCat').value;
            item.price = parseInt(document.getElementById('editPrice').value) || 0;
            item.cost = parseInt(document.getElementById('editCost').value) || 0;
            item.veg = document.getElementById('editVeg').classList.contains('on');
            item.popular = document.getElementById('editPopular').classList.contains('on');
            item.active = document.getElementById('editActive').classList.contains('on');

            closeModal('editModal');
            renderFilters();
            renderMenu();
            showToast(`‚úÖ "${name}" updated successfully`);
        }

        // ‚îÄ‚îÄ PAUSE / ENABLE ‚îÄ‚îÄ
        function togglePause(idx) {
            const item = menuItems[idx];
            item.active = !item.active;
            renderMenu();
            showToast(item.active ? `‚ñ∂Ô∏è "${item.name}" is now active` : `‚è∏Ô∏è "${item.name}" has been paused`, item.active ? 'success' : 'warning');
        }

        // ‚îÄ‚îÄ DELETE ‚îÄ‚îÄ
        function openDeleteModal(idx) {
            deleteIndex = idx;
            document.getElementById('deleteItemName').textContent = menuItems[idx].name;
            openModal('deleteModal');
        }

        function confirmDelete() {
            if (deleteIndex < 0) return;
            const name = menuItems[deleteIndex].name;
            menuItems.splice(deleteIndex, 1);
            deleteIndex = -1;

            closeModal('deleteModal');
            renderFilters();
            renderMenu();
            updateItemCount();
            showToast(`üóëÔ∏è "${name}" deleted from menu`, 'error');
        }

        // ‚îÄ‚îÄ ADD NEW ITEM ‚îÄ‚îÄ
        function openAddModal() {
            document.getElementById('addName').value = '';
            document.getElementById('addPrice').value = '';
            document.getElementById('addCost').value = '';
            document.getElementById('addVeg').className = 'toggle-switch';
            document.getElementById('addPopular').className = 'toggle-switch';

            const catSelect = document.getElementById('addCat');
            catSelect.innerHTML = getCategories().map(c =>
                `<option value="${c}">${c}</option>`
            ).join('');

            openModal('addModal');
        }

        function saveNewItem() {
            const name = document.getElementById('addName').value.trim();
            if (!name) { showToast('Please enter an item name', 'error'); return; }

            const price = parseInt(document.getElementById('addPrice').value) || 0;
            const cost = parseInt(document.getElementById('addCost').value) || 0;
            if (price <= 0) { showToast('Please enter a valid price', 'error'); return; }

            menuItems.push({
                name,
                cat: document.getElementById('addCat').value,
                price,
                cost,
                active: true,
                popular: document.getElementById('addPopular').classList.contains('on'),
                veg: document.getElementById('addVeg').classList.contains('on'),
            });

            closeModal('addModal');
            renderFilters();
            renderMenu();
            updateItemCount();
            showToast(`‚ûï "${name}" added to menu`);
        }

        // ‚îÄ‚îÄ INIT ‚îÄ‚îÄ
        document.getElementById('menuSearch').addEventListener('input', renderMenu);
        renderFilters();
        renderMenu();
    </script>
</body>

</html>